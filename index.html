<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-Message-Package-Main.html">Main</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext">getBitMapHex_127_ext</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext_25">getBitMapHex_127_ext_25</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBmpsBinary">getBmpsBinary</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBufferMessage">getBufferMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getIsoJSON">getIsoJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getMti">getMti</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toAdvice">toAdvice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toResponse">toResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toRetransmit">toRetransmit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#validateMessage">validateMessage</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Bitmap-Assemble.html">Bitmap-Assemble</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Message-Package.html">Message-Package</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Message-UnPackage.html">Message-UnPackage</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>ISO_8583</h1>
<p><a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/zemuldo/iso_8583.svg" alt="Greenkeeper badge"></a>~<img src="https://travis-ci.org/zemuldo/iso_8583.svg?branch=main" alt="Travis CI build badge">~<a href="https://snyk.io/test/github/zemuldo/iso_8583?targetFile=package.json"><img src="https://snyk.io/test/github/zemuldo/iso_8583/badge.svg?targetFile=package.json" alt="Known Vulnerabilities"></a></p>
<p>ISO_8583 is a <span style="color:green; font-size:18px">Customizable ISO 8583 Library for JavaScript and NodeJS</span> that does message conversion between a system and an interface that exchange <a href="https://en.wikipedia.org/wiki/ISO_8583">ISO 8583 Financial transaction card originated messages</a>.</p>
<h2>Install from npm using</h2>
<pre class="prettyprint source lang-shell"><code>
npm install --save iso_8583
</code></pre>
<h3>OR</h3>
<pre class="prettyprint source lang-shell"><code>yarn add iso_8583
</code></pre>
<h2>Basic Usage: Bitmap Messaging</h2>
<p>See the a sample usage example see <a href="https://github.com/zemuldo/iso_8583/tree/main/example">this example</a></p>
<pre class="prettyprint source lang-javascript"><code>const iso8583 = require('iso_8583');
let data = {
    0: &quot;0100&quot;,
    2: &quot;4761739001010119&quot;,
    3: &quot;000000&quot;,
    4: &quot;000000005000&quot;,
    7: &quot;0911131411&quot;,
    12: &quot;131411&quot;,
    13: &quot;0911&quot;,
    14: &quot;2212&quot;,
    18: &quot;4111&quot;,
    22: &quot;051&quot;,
    23: &quot;001&quot;,
    25: &quot;00&quot;,
    26: &quot;12&quot;,
    32: &quot;423935&quot;,
    33: &quot;111111111&quot;,
    35: &quot;4761739001010119D22122011758928889&quot;,
    41: &quot;12345678&quot;,
    42: &quot;MOTITILL_000001&quot;,
    43: &quot;My Termianl Business                    &quot;,
    49: &quot;404&quot;,
    52: &quot;7434F67813BAE545&quot;,
    56: &quot;1510&quot;,
    123: &quot;91010151134C101&quot;,
    127: &quot;000000800000000001927E1E5F7C0000000000000000500000000000000014A00000000310105C000128FF0061F379D43D5AEEBC8002800000000000000001E0302031F000203001406010A03A09000008CE0D0C840421028004880040417091180000014760BAC24959&quot;
};

let customFormats = {
    '3': {
      ContentType: 'n',
      Label: 'Processing code',
      LenType: 'fixed',
      MaxLen: 9
    }
  };

let isopack = new iso8583(data,customFormats);
</code></pre>
<p>The object initialized has the following methods:</p>
<h5>To validate the iso message</h5>
<pre class="prettyprint source lang-javascript"><code>isopack.validateMessage();  // returns true for valid message or error

</code></pre>
<h5>To get the mti as a string:</h5>
<pre class="prettyprint source lang-javascript"><code>isopack.getMti(); // returns a 4 byte buffer containing the mti

</code></pre>
<h5>To get the bitmaps in binary:</h5>
<pre class="prettyprint source lang-javascript"><code>isopack.getBmpsBinary(); // returns a string '1111001000111..' or an error object with error prop

</code></pre>
<h5>To get the bitmap active fields:</h5>
<pre class="prettyprint source lang-javascript"><code>isopack.getBitMapFields(); 
// returns the array of enabled fields in bitmap, excluding MTI and bitmap fields
// e.g. [2, 3, 4, 7, 12, 13, 14, 18, 22, 23, 25, 26, 32, 33, 35, 41, 42, 43, 49, 52, 56, 123, 127]

</code></pre>
<h5>To get the bitmaps in hex for fields 0-127, fields 127 extensions and fields 127.25 extensions</h5>
<pre class="prettyprint source lang-javascript"><code>isopack.getBitMapHex();             // returns 'f23c46c1a8e091000000000000000022'
isopack.getBitMapHex_127_ext();     // returns '8000008000000000'
isopack.getBitMapHex_127_ext_25();  // returns 'fe1e5f7c00000000'

// in case of error, the error object returned with error prop
</code></pre>
<h5>To get a raw message:</h5>
<pre class="prettyprint source lang-javascript"><code>let bufferMessage = isopack.getRawMessage(); 
// returns a buffer containing the message (without 2-byte length field) or an error object
&lt;Buffer 30 31 30 30 f2 3c 46 c0 20 e8 80 00 00 00 00 00 00 00 00 20 30 37 35 34 ...

</code></pre>
<h5>To get a buffer tcp message to send to the ISO 8583 Interface:</h5>
<pre class="prettyprint source lang-javascript"><code>let bufferMessage = isopack.getBufferMessage(); 
// returns a buffer containing the message with 2 additional bytes indicating the length 
// or an error object
&lt;Buffer 01 11 30 31 30 30 f2 3c 46 c0 20 e8 80 00 00 00 00 00 00 00 00 20 30 37 35 34 ...

</code></pre>
<h5>To get the field description:</h5>
<pre class="prettyprint source lang-javascript"><code>const iso8583 = require('iso_8583');
iso8583.getFieldDescription(24);
// The object with field descriptions to be returned:
// {24: 'Network International identifier (NII)'}
</code></pre>
<h3>To get the several fields descriptions:</h3>
<pre class="prettyprint source lang-javascript"><code>const iso8583 = require('iso_8583');
iso8583.getFieldDescription([24, 37, 39]);
// The object with field descriptions to be returned:
// {
//    24: 'Network International identifier (NII)'},
//    37: 'Retrieval reference number', 
//    39: 'Response code'
// }
</code></pre>
<p>To unpack a message from the interface, that usually comes in a tcp stream/buffer just parse the incoming buffer or string to the method</p>
<pre class="prettyprint source lang-javascript"><code>let incoming = new isopack().getIsoJSON(incoming);
// returns parsed json object:
let testData = {
    &quot;0&quot;: &quot;0100&quot;,
    &quot;2&quot;: &quot;5413330&quot;,
    &quot;3&quot;: &quot;000000&quot;,
    &quot;4&quot;: &quot;000000002000&quot;,
    &quot;7&quot;: &quot;0210160607&quot;,
    &quot;11&quot;: &quot;148893&quot;,
    &quot;12&quot;: &quot;160607&quot;,
    &quot;13&quot;: &quot;0210&quot;,
    &quot;14&quot;: &quot;2512&quot;,
    &quot;18&quot;: &quot;4111&quot;,
    &quot;22&quot;: &quot;141&quot;,
    &quot;23&quot;: &quot;003&quot;,
    &quot;25&quot;: &quot;00&quot;,
    &quot;26&quot;: &quot;12&quot;,
    &quot;35&quot;: &quot;5413330089020011D2512601079360805F&quot;,
    &quot;41&quot;: &quot;31327676&quot;,
    &quot;42&quot;: &quot;4D4F424954494C4&quot;,
    &quot;43&quot;: &quot;My Termianl Business                    &quot;,
    &quot;49&quot;: &quot;404&quot;,
    &quot;45&quot;: &quot;0303030204E4149524F4249204B452dataString04B45&quot;,
    &quot;123&quot;: &quot;09010001000105010103040C010001&quot;
};

</code></pre>
<h2>Basic Usage: XML Messaging</h2>
<h3>To get xml from a json</h3>
<p>Initialize the iso object with the json as argument</p>
<pre class="prettyprint source lang-javascript"><code>let isoPack = new isoPack(testData);
isoPack.getXMLString();     // returns a string of iso 8583 xml string
</code></pre>
<p>To get json form the xml string</p>
<pre class="prettyprint source lang-javascript"><code>let isoPack = new isoPack();    // Initialize with no argument
</code></pre>
<p>Parse the string to the method to get the iso json</p>
<pre class="prettyprint source lang-javascript"><code>let xmlData = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?>\n' +
    '&lt;Iso8583PostXml>\n' +
    '&lt;MsgType>0200&lt;/MsgType>\n' +
    '&lt;Fields>\n' +
    '&lt;Field_002>4839123456709012&lt;/Field_002>\n' +
    '&lt;Field_003>000000&lt;/Field_003>\n' +
    '&lt;Field_004>000000001500&lt;/Field_004>\n' +
    '&lt;Field_007>0604074705&lt;/Field_007>\n' +
    '&lt;Field_011>804058&lt;/Field_011>\n' +
    '&lt;Field_012>074808&lt;/Field_012>\n' +
    '&lt;Field_013>0604&lt;/Field_013>\n' +
    '&lt;Field_014>0812&lt;/Field_014>\n' +
    '&lt;Field_015>0905&lt;/Field_015>\n' +
    '&lt;Field_022>901&lt;/Field_022>\n' +
    '&lt;Field_025>02&lt;/Field_025>\n' +
    '&lt;Field_026>05&lt;/Field_026>\n' +
    '&lt;Field_028>000000500&lt;/Field_028>\n' +
    '&lt;Field_030>000000500&lt;/Field_030>\n' +
    '&lt;Field_032>483912&lt;/Field_032>\n' +
    '&lt;Field_035>4839123456709012=08125876305082011&lt;/Field_035>\n' +
    '&lt;Field_037>D000A0030000&lt;/Field_037>\n' +
    '&lt;Field_040>507&lt;/Field_040>\n' +
    '&lt;Field_041>FOFUGUT1&lt;/Field_041>\n' +
    '&lt;Field_042>191121119111112&lt;/Field_042>\n' +
    '&lt;Field_043>Postilion Cafeteria Rondebosch ZA&lt;/Field_043>\n' +
    '&lt;Field_049>710&lt;/Field_049> &lt;Field_056>1510&lt;/Field_056>\n' +
    '&lt;Field_059>0000000072&lt;/Field_059>\n' +
    '&lt;Field_123>211401213041013&lt;/Field_123>\n' +
    '&lt;Field_127_002>0007713856&lt;/Field_127_002>\n' +
    '&lt;Field_127_009>013040604040604016501100330000&lt;/Field_127_009>\n' +
    '&lt;Field_127_012>My Terminal Business&lt;/Field_127_012>\n' +
    '&lt;Field_127_020>20100604&lt;/Field_127_020>\n' +
    '&lt;/Fields>\n' +
    '&lt;/Iso8583PostXml>';

isoPack.getJsonFromXml(xmlData); // returns a json object or an error object
</code></pre>
<h2>Usage: MTI converting</h2>
<h3>Changing current mti type</h3>
<p>Initialize the iso object with the json as argument</p>
<pre class="prettyprint source lang-javascript"><code>  let data = {
    0: '0400',
    2: '4761739001010119',
    3: '000000',
    4: '000000005000',
    7: '0911131411'
  };

  let isopack = new isoPack(data);
  isoPack.toRetransmit()
  isoPack.getMti(); // returns '0401'
  
  isopack = new isoPack(data);
  isoPack.toResponse(); 
  isoPack.getMti(); // returns '0410'
  
  isopack = new isoPack(data);
  isoPack.toAdvice(); 
  isoPack.getMti(); // returns '0420'
  
</code></pre>
<p>There are other cool stuff like <code>isoPack.attachTimeStamp()</code> which adds times stamps to field 7,12,13, plus more
When working with xml, first change the xml to json then validate.</p>
<h2>Configuration and Customization</h2>
<h3>Custom ISO 8583 Formats.</h3>
<p>This library Supports custom ISO 8583 Formats, versions 1993 and 2003. This means you can decide what data types are allowed on each field, the length properties of the field and its description.
Custom ISO 8583 formats must be passed in the format below.</p>
<pre class="prettyprint source lang-javascript"><code>{
      'FIELD_NAME': {
        ContentType: 'Types accepted',
        Label: 'Description of the field',
        LenType: 'Length type can bee fixed or lvar ...',
        MaxLen: Maximum length (number)
      }
    }
</code></pre>
<p>Here is an example of custom format for field 3. You can refer to formats in the docs to see the default formats.</p>
<pre class="prettyprint source lang-javascript"><code>
let customFormats = {
    '3': {
      ContentType: 'n',
      Label: 'Processing code',
      LenType: 'fixed',
      MaxLen: 9
    }
  };

</code></pre>
<h3>Required fields</h3>
<p>You can also set required field for message types as you desire.
To use required fields you need to create a json config file and add to the class when creating a new message class, thats two ways works:</p>
<pre class="prettyprint source lang-javascript"><code>let isopack = new iso8583(iso);
isopack.requiredFieldsSchema = './config/required-fields.json';
</code></pre>
<pre class="prettyprint source lang-javascript"><code>const required_fields = './config/required-fields.json';
let isopack = new iso8583(iso, customFormats, required_fields);
</code></pre>
<p>And at the config file you can organize by process code and by messages codes, like this:</p>
<pre class="prettyprint source lang-json"><code>[
  {
    &quot;processing_code&quot;: &quot;000000&quot;,
    &quot;required_fields&quot;: [0, 2, 4]
  },
  {
    &quot;processing_code&quot;: &quot;999999&quot;,
    &quot;required_fields&quot;:[
      {
        &quot;0100&quot;: [3, 7],
        &quot;0500&quot;: [3, 7, 11]
      }
    ]
  }
]
</code></pre>
<h3>Message Packaging and Un-packaging</h3>
<p>This library uses a default mode of message encoding and packaging. If you are using a third party message source or a third party packaging source, you have to pre-format your data to meet the default encoding or configure things for yourself. See configuration for more info.</p>
<h3>Unpacking</h3>
<p>This only applies when you are receiving messages from others sources that don't encode as per this library like JPos.
Default unpack conditions:</p>
<p><code>2-byte leng header in hex</code> + <code>4-byte MTI encoded in utf8</code> + <code>16-byte Bitmap encoded in hex</code></p>
<p>If the message you are receiving is in a different state, the passing config to <code>getIsoJSON</code> like below.</p>
<h3>Packing</h3>
<p>Messages are packaged as:</p>
<ul>
<li>2 byte length indicator + 4 byte message type + 16 byte bitmap(primary + secondary bitmap) + message field data.</li>
<li>Each field with variable length data is preceded with the actual length of the data in that field.</li>
</ul>
<h6><span style="color:blue">Field 127 and 127.25</span></h6>
<blockquote>
<p>The library extends fields 127 and fields 127.25 to their sub fields.<br>
If you are handling a json with field 127 or 127.25 as one string, the bitmap must be 16 character string then a 4 digit number indicating the length
In the above case the library will expand them.<br>
If they are already broken down to subfields, nothing changes.<br>
To invoke the package initialize with the iso8583 json or object as argument. If the json contains any fields not defined in iso8583 or has no field 0, the error is returned in an object.<br>
If you want to handle xml iso 8583 messages, the usage is described down there.</p>
</blockquote>
<h2><span style="color:green">Thanks</span> , <span style="color:blue">Have</span> <span style="color:orange">Fun</span></h2></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Tue Apr 05 2022 06:32:20 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>