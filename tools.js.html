<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>tools.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-Message-Package-Main.html">Main</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext">getBitMapHex_127_ext</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext">getBitMapHex_127_ext</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext_25">getBitMapHex_127_ext_25</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBitMapHex_127_ext_25">getBitMapHex_127_ext_25</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBmpsBinary">getBmpsBinary</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBmpsBinary">getBmpsBinary</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBufferMessage">getBufferMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getBufferMessage">getBufferMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getIsoJSON">getIsoJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getIsoJSON">getIsoJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getMti">getMti</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#getMti">getMti</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toAdvice">toAdvice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toAdvice">toAdvice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toResponse">toResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toResponse">toResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toRetransmit">toRetransmit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#toRetransmit">toRetransmit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#validateMessage">validateMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Message-Package-Main.html#validateMessage">validateMessage</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Bitmap-Assemble.html">Bitmap-Assemble</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-DataTypes.html">DataTypes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-DataTypes.html#~checkDataType">checkDataType</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Formats.html">Formats</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Helpers.html">Helpers</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Message-Package.html">Message-Package</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Message-UnPackage.html">Message-UnPackage</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Tools.html">Tools</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Tools.html#~getHex">getHex</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Tools.html#~getHexString">getHexString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Tools.html#~getResType">getResType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Tools.html#~getTCPHeaderBuffer">getTCPHeaderBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Tools.html#~toErrorObject">toErrorObject</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">tools.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const formats = require('./formats');
const accTypes = require('./accountTypes');
const transTypes = require('./transactionTypes');
const transStatus = require('./transactionStatus');
let checkTypes = require('./types');

/**
 * Handy Utils for transforming data
 * @module Tools
 */

const T = {
  /**
   * Convert TCP message string length to a buffer, should be a number that fits in one byte.
   * @method getTCPHeaderBuffer
   * @param {integer} indicator length of ISO 8583 message string.
   * @returns {buffer} 1 byte buffer representing the message length indicator
   */
  getTCPHeaderBuffer: (indicator)=> {
    const integer = Number(indicator);
    return Buffer.alloc(1, integer, 'hex');
  },
  /**
   * Format error to a universal object. Can take an array of strings to join or just a string.
   * @method toErrorObject
   * @param {string|string[]} errors
   * @returns {object} Object having property error
   * @example Tools.toErrorObject("some error") -> {error: "some error"}
   * @example Tools.toErrorObject("some error on field", 67, "happened" ) -> {error: "some error on field 67 happened"}
   */
  toErrorObject: errors =>{
    if (Array.isArray(errors)) return {error: errors.join('')};
    else return {error: errors};
  },
  /**
   * Convert a hexadecimal string in to binary string: To a string of 0s and 1s
   * @method getHex
   * @param {string} hexaString
   * @returns {string} A string of 0s and 1s representing the hexadecimal string input
   * @example Tools.getHex("EF") -> "11101111"
   * @example Tools.getHex("EFEF") -> "1110111111101111"
   */
  getHex: hexaString => {
    const mapping = {
      '0': '0000',
      '1': '0001',
      '2': '0010',
      '3': '0011',
      '4': '0100',
      '5': '0101',
      '6': '0110',
      '7': '0111',
      '8': '1000',
      '9': '1001',
      'a': '1010',
      'b': '1011',
      'c': '1100',
      'd': '1101',
      'e': '1110',
      'f': '1111',
      'A': '1010',
      'B': '1011',
      'C': '1100',
      'D': '1101',
      'E': '1110',
      'F': '1111',
    };
    let bitmaps = '';
    for (let i = 0; i &lt; hexaString.length; i++)
      bitmaps += mapping[hexaString[i]];

    return bitmaps;
  },

  /**
   * Convert a string of integers to hexadecimal string.
   * @method getHexString
   * @param {string} string A string of integers
   * @returns {string} A hexadecimal string representation of the string of integers received
   * @example T.getHexString("123456") -> "1e240"
   */
  getHexString: string => {
    return parseInt(string, 10).toString(16);
  },

  getLenType: lentype => {
    switch (lentype) {
      case 'lvar':
        return 1;

      case 'llvar':
        return 2;

      case 'lllvar':
        return 3;

      case 'llllvar':
        return 4;

      case 'lllllvar':
        return 5;

      case 'llllllvar':
        return 6;

      default:
        return 0;
    }
  },

  validateFields: (obj, customFormats) => {
    let state = false;
    for (let field in obj) {
      if (obj.hasOwnProperty(field)) {
        let this_format = customFormats[field] || formats[field];
        if (this_format &amp;&amp; checkTypes(this_format, obj[field])) {
          state = true;
        } else {
          return {
            error: 'field ' + field + ' error'
          };
        }
      }
    }
    return state;
  },

  /**
   * Get the expected response MTI of an MTI
   * @method getResType
   * @param {string} reqType The request or outgoing MTI
   * @returns {string|object} The expected response MTI | Error object
   * @example T.getResType("0100") -> "0110"
   * @example T.getResType("01000") ->  {error: 'mti invalid'}
   */
  getResType: reqType => {
    switch (reqType) {
      case '0100':
      case '0101':
        return '0110';

      case '0120':
      case '0121':
        return '0130';

      case '0200':
      case '0201':
        return '0210';

      case '0202':
      case '0203':
        return '0212';

      case '0220':
      case '0221':
        return '0230';

      case '0332':
        //'0323' ignored
        return '0322';

      case '0400':
      case '0401':
        return '0410';
      
      case '0410':
      case '0420':
      case '0421':
        return '0430';

      case '0500':
      case '0501':
        return '0510';

      case '0520':
      case '0521':
        return '0530';

      case '0532':
        //'0523' ignored
        return '0522';

      case '0600':
      case '0601':
        return '0610';

      case '0620':
      case '0621':
        return '0630';

      default: return {error: 'mti invalid'};
    }

  },

  getTransType: (id) => {
    if (transTypes[id])
      return transTypes[id];
    else
      return 'Code ' + id + ' Name Undefined';
  },

  getAccType: (id) => {
    if (accTypes[id])
      return accTypes[id];
    else
      return 'Code ' + id + ' Name Undefined';
  },

  getTranStatus: (id) => {
    if (transStatus[id])
      return transStatus[id];
    else
      return 'Code ' + id + ' Name Undefined';
  }
};

module.exports = T;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon Jun 14 2021 14:00:01 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
